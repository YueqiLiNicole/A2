# version: 0.2

# phases:
#   install:
#     commands:
#       # Install any necessary dependencies
#       # e.g., AWS CLI, specific software or libraries required by your Lambda
#       - echo Installing source dependencies...
#       - pip install -r requirements.txt -t .

#   pre_build:
#     commands:
#       # Pre-build steps like setting up environment variables
#       - echo Pre-build phase...

#   build:
#     commands:
#       # Commands to build your Lambda function
#       - echo Build started on `date`
#       - echo Compiling the Lambda function...
#       # Replace with commands to compile/build your Lambda function
#       - zip -r search-photos.zip .

#   post_build:
#     commands:
#       # Commands for post-build actions, like copying the build artifacts to S3
#       - echo Post-build phase...
#       - echo Build completed on `date`

# artifacts:
#   files:
#      - '**/*'
#   # Specify the name of the output artifact generated by the build
#   name: search-photos-$(date +%Y-%m-%d)


# version: 0.2

# phases:
#   install:
#     commands:
#       - echo Installing source dependencies...
#       - pip install -r requirements.txt -t .

#   pre_build:
#     commands:
#       - echo Pre-build steps...

#   build:
#     commands:
#       - echo Building Lambda function...
#       - zip -r search-photos.zip search-photos.py
#       # Include additional files or dependencies as needed
#   post_build:
#     commands:
#       - echo Uploading to S3...
#       - aws s3 cp search-photos.zip s3://6998-photos-b1/lambda/search-photos.zip

# artifacts:
#   files:
#     - search-photos.zip

version: 0.2

phases:
  install:
    commands:
      - echo Installing required packages...
      - yum install -y zip
      - curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
      - unzip awscliv2.zip
      - ./aws/install
  pre_build:
    commands:
      - echo Preparing the package...
  build:
    commands:
      - echo Zipping the Lambda function code...
      - zip -r search-photos.zip search-photos.py
      - echo Uploading the package to S3...
      - aws s3 cp search-photos.zip s3://6998-photos-b1/lambda/search-photos.zip
  post_build:
    commands:
      - echo Deploying the Lambda function...
      - aws lambda update-function-code --function-name search-photos --s3-bucket 6998-photos-b1 --s3-key lambda/search-photos.zip

artifacts:
  files:
    - search-photos.zip
